var app=angular.module("blockcv",["ngRoute"]);app.controller("EmployerCtrl",["$scope","BlockCVSvc",function(a,b){a.search=function(c){var d={studentId:c,employerName:"Global INC"};b.getStudentEmployer(d).success(function(b){a.student=b.result.message}).error(function(a){console.error(a),alert(a)})}}]),app.controller("HomeCtrl",["$scope",function(a){}]),app.controller("StudentCtrl",["$scope","$routeParams","BlockCVSvc",function(a,b,c){function d(){c.getStudent(a.studentId).success(function(b){return b.result&&b.result.message?void(a.student=b.result.message):(alert("There was a problem.  Check the console for the data"),void console.log(b))}).error(function(a){console.error(a),alert(a)})}a.studentId=b.id,d(),a.grantAccess=function(b){var e={employerName:b,studentId:a.studentId};c.grantAccess(e).success(function(a){console.log(a),d()}).error(function(a){console.error(a),alert(a)})}}]),app.controller("UniCtrl",["$scope","$routeParams","BlockCVSvc",function(a,b,c){a.search=function(b){var d={studentId:b};a.studentId=b,c.getStudent(d).success(function(b){a.student=b.result.message}).error(function(a){console.error(a),alert(a)})},a.addQualification=function(b){var d={studentId:a.studentId,qualification:b};c.addQualification(d).success(function(a){window.location.href="#/uni"}).error(function(a){console.error(a),alert(a)})}}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/home",{templateUrl:"app/partials/home.html",controller:"HomeCtrl"}).when("/uni",{templateUrl:"app/partials/uni.html",controller:"UniCtrl"}).when("/student/:id",{templateUrl:"app/partials/student.html",controller:"StudentCtrl"}).when("/employer",{templateUrl:"app/partials/employer.html",controller:"EmployerCtrl"}).when("/employer-results",{templateUrl:"app/partials/employer-results.html",controller:"EmployerCtrl"}).when("/add-qualification",{templateUrl:"app/partials/addqualification.html",controller:"HomeCtrl"}).otherwise({redirectTo:"/home"})}]),app.factory("BlockCVSvc",["$http",function(a){function b(a){if(!a.method)return alert("You must specify an method"),void console.error("You must specify an method");var b={jsonrpc:"2.0",method:a.method,params:{type:1,chaincodeID:{},ctorMsg:{args:["init","a","1000","b","2000"]}},id:1};a.name&&(b.params.chaincodeID.name=a.name),a.path&&(b.params.chaincodeID.path=a.path),b.params.ctorMsg.args=a.args||[],a.function&&b.params.ctorMsg.args.unshift(a.function||"dummy");var c=new Date;return b.id=c.getTime(),b}function c(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))}var d=this;return d.config={},a.get("config.json").success(function(a){d.config=a||{},console.log(d.config)}),d.grantAccess=function(c){var e={method:"invoke",function:"grant-access",args:[c.studentId,c.employerName],name:d.config.blockCVChaincodeAddress},f=b(e);return a.post(d.config.peerRestAddress,f)},d.createStudent=function(e){var f=c(e.name+e.dateofbirth),g={method:"invoke",function:"create-student",args:[f,e],name:d.config.blockCVChaincodeAddress},h=b(g);return a.post(d.config.peerRestAddress,h)},d.getStudent=function(c){var e={method:"query",function:"student-get",args:[c],name:d.config.blockCVChaincodeAddress},f=b(e);return a.post(d.config.peerRestAddress,f)},d.getStudentEmployer=function(c){var e={method:"query",function:"employer-get",args:[c.studentId,c.employerName],name:d.config.blockCVChaincodeAddress},f=b(e);return a.post(d.config.peerRestAddress,f)},d.addQualification=function(c){var e={method:"invoke",function:"add-qualification",args:[c.studentId,c.qualification],name:d.config.blockCVChaincodeAddress},f=b(e);return a.post(d.config.peerRestAddress,f)},d}]);