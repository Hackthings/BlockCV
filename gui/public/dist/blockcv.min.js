var app=angular.module("blockcv",["ngRoute"]);app.controller("EmployerCtrl",["$scope","BlockCVSvc",function(a,b){a.search=function(c){var d={studentId:c,employerName:"Global INC"};b.getStudentEmployer(d).success(function(b){a.student=b.result.message}).error(function(a){console.error(a),alert(a)})}}]),app.controller("HomeCtrl",["$scope",function(a){}]),app.controller("StudentCtrl",["$scope","$routeParams","BlockCVSvc",function(a,b,c){function d(){c.getStudent(a.studentId).success(function(b){return b.result&&b.result.message?(console.log(b),void(a.student=JSON.parse(b.result.message))):(alert("There was a problem.  Check the console for the data"),void console.log(b))}).error(function(a){console.error(a),alert(a)})}a.studentId=b.id,d(),a.employer={},a.grantAccess=function(b){var e={employerName:b,studentId:a.studentId};c.grantAccess(e).success(function(a){console.log(a),d()}).error(function(a){console.error(a),alert(a)})}}]),app.controller("UniCtrl",["$scope","$routeParams","BlockCVSvc",function(a,b,c){a.search=function(b){var d={studentId:b};a.studentId=b,c.getStudent(d).success(function(b){a.student=b.result.message}).error(function(a){console.error(a),alert(a)})},a.addQualification=function(a){a.institution="University of Bedfordshire";var b={studentId:a.studentId,qualification:a};c.addQualification(b).success(function(b){console.log(JSON.stringify(b)),window.location.href="#/student/"+a.studentId}).error(function(a){console.error(a),alert(a)})},a.addStudent=function(b){a.success=!1,c.createStudent(b).success(function(b){console.log("RESPONSE",JSON.stringify(b)),a.success=!0,a.key=c.lastKey||"No Key"}).error(function(a){alert(JSON.stringify(a))})}}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/home",{templateUrl:"app/partials/home.html",controller:"HomeCtrl"}).when("/uni",{templateUrl:"app/partials/uni.html",controller:"UniCtrl"}).when("/student/:id",{templateUrl:"app/partials/student.html",controller:"StudentCtrl"}).when("/employer",{templateUrl:"app/partials/employer.html",controller:"EmployerCtrl"}).when("/employer-results",{templateUrl:"app/partials/employer-results.html",controller:"EmployerCtrl"}).when("/add-qualification",{templateUrl:"app/partials/addqualification.html",controller:"UniCtrl"}).when("/studentsearchResults",{templateUrl:"app/partials/studentsearchResults.html",controller:"HomeCtrl"}).otherwise({redirectTo:"/home"})}]),app.factory("BlockCVSvc",["$http",function(a){function b(a){if(!a.method)return alert("You must specify an method"),void console.error("You must specify an method");var b={jsonrpc:"2.0",method:a.method,params:{type:1,chaincodeID:{},ctorMsg:{args:[]}},id:1};a.name&&(b.params.chaincodeID.name=a.name),a.path&&(b.params.chaincodeID.path=a.path),b.params.ctorMsg.args=a.args||[],a.function&&(b.params.ctorMsg.function=a.function);var c=new Date;return b.id=c.getTime(),console.log(JSON.stringify(b,null,4)),b}function c(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))}var d=this;d.config={},a.get("config.json").success(function(a){d.config=a||{},console.log(d.config)});var e="http://localhost:7050/chaincode",f="2cc2f10c7376e1a85c503c6d1a622c28e24b0b90c215de986d86dac71ad2eb0d4e96f705ec6eeba09ed4e729467d13e8e010aff70e700444760d289494b1a453";return d.grantAccess=function(c){var d={method:"invoke",function:"grant-access",args:[c.studentId,c.employerName],name:f},g=b(d);return a.post(e,g)},d.createStudent=function(g){var h=c(g.name+g.dateofbirth);d.lastKey=h;var i={method:"invoke",function:"create-student",args:[h,JSON.stringify(g)],name:f},j=b(i);return a.post(e,j)},d.getStudent=function(c){var d={method:"query",function:"student-get",args:[c],name:f},g=b(d);return console.log(e),a.post(e,g)},d.getStudentEmployer=function(c){var d={method:"query",function:"employer-get",args:[c.studentId,c.employerName],name:f},g=b(d);return a.post(e,g)},d.addQualification=function(c){var d={method:"invoke",function:"add-qualification",args:[c.studentId,JSON.stringify(c.qualification)],name:f},g=b(d);return a.post(e,g)},d}]);